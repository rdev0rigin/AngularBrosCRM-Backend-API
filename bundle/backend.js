!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=19)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2);!function(){o.Server.bootstrap()}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAIL_API_KEY="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"},function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(14),i=n(13),s=n(18),u=n(6),c=n(4),a=n(3),p=function(e){function t(){var t=e.call(this)||this;return t.port=1729,t.app=i(),t.config(),t.endPoints(),t}return o(t,e),t.bootstrap=function(){return new t},t.prototype.config=function(){this.server=r.createServer(this.app),console.log("listening on port "+this.port),this.server.listen(this.port),this.IO=s(this.server),this.crmStoreManager=new u.CRMStoreManager,this.emailManager=new a.EmailManager},t.prototype.endPoints=function(){var e=this;this.IO.on("connection",function(t){e.socketOnCompanies(t,e.crmStoreManager),e.socketOnQuotes(t,e.crmStoreManager),e.socketOnContacts(t,e.crmStoreManager),e.socketOnUsers(t,e.crmStoreManager),e.socketOnNotes(t,e.crmStoreManager),e.socketOnEmailer(t,e.emailManager)})},t}(c.Endpoints);t.Server=p},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function u(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,u)}c((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,i&&(s=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,s,u,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u};Object.defineProperty(t,"__esModule",{value:!0});var i=n(16),s=n(1),u=function(){function e(){this.sendGrid=i,this.mail=i.mail}return e.prototype.sendQuoteEmail=function(e,t,n){return void 0===n&&(n="Sending from AngularBros is Fun"),o(this,void 0,void 0,function(){var o,i,u,c,a,p;return r(this,function(r){return o=new this.mail.Email("AngularBros@example.com"),i=new this.mail.Email(t),u=new this.mail.Content("text/html",e),c=new this.mail.Mail(o,n,i,u),a=this.sendGrid(s.MAIL_API_KEY),p=a.emptyRequest({method:"POST",path:"/v3/mail/send",body:c.toJSON()}),[2,a.API(p)]})})},e}();t.EmailManager=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.socketOnEmailer=function(e,t){e.on("email.quote",function(n){console.log(n),t.sendQuoteEmail(n.template,n.sendTo,n.subject).then(function(t){e.emit("email.quote.response",t)}).catch(function(t){e.emit("email.quote.response",t)})})},e.prototype.socketOnNotes=function(e,t){e.on("note.create",function(n){console.log("NoteCreated",n),n?t.createNote(n).then(function(t){e.emit("note.create.response",t)}):e.emit("note.create.response",{error:"Cannot create without payload."})}),e.on("notes.get",function(n){n&&"string"==typeof n.id?t.getNote(n).then(function(t){e.emit("notes.get.response",t)}):(console.log("get notes",n),t.getNotes(n).then(function(t){e.emit("notes.get.response",t)}))}),e.on("note.set",function(n){t.setNoteProp(n).then(function(t){e.emit("note.set.response",t)})}),e.on("note.destroy",function(n){t.destroyNote(n).then(function(t){e.emit("note.destroy.response",t)})})},e.prototype.socketOnUsers=function(e,t){e.on("user.get",function(n){n&&"string"==typeof n.id?t.getUser(n).then(function(t){e.emit("user.get.response",t)},function(e){console.log("error",e)}):e.emit("user.get.response",{error:"No ID in payload"})}),e.on("user.set",function(n){console.log("user.set.response",n),t.setUserProps(n).then(function(t){e.emit("user.set.response",t)},function(e){console.log("error",e)})})},e.prototype.socketOnQuotes=function(e,t){e.on("quote.create",function(n){n&&t.createQuote(n).then(function(t){e.emit("quote.create.response",t)},function(e){console.log("error",e)})}),e.on("quotes.get",function(n){t.getQuotes(n).then(function(t){e.emit("quotes.get.response",t)})}),e.on("quote.get",function(n){t.getQuote(n).then(function(t){e.emit("quote.get.response",t)},function(e){console.log("error",e)})}),e.on("quote.set",function(n){t.setQuoteProps(n).then(function(t){e.emit("quote.set.response",t)},function(e){console.log("error",e)})}),e.on("quoteLine.set",function(n){t.setQuoteLineProps(n).then(function(t){e.emit("quoteLine.set.response",t)},function(e){console.log("error",e)})}),e.on("quoteLine.create",function(n){t.createQuoteLine(n).then(function(t){e.emit("quoteLine.create.response",t)})}),e.on("quote.destroy",function(n){t.destroyQuote(n).then(function(t){e.emit("quote.destroy.response",t)})}),e.on("quoteLine.destroy",function(n){t.destroyQuoteLine(n).then(function(t){e.emit("quoteLine.destroy.response",t)})})},e.prototype.socketOnContacts=function(e,t){e.on("contact.create",function(n){n&&t.createContact(n).then(function(t){e.emit("contact.create.response",t)},function(e){console.log("error",e)})}),e.on("contacts.get",function(n){n&&"string"==typeof n.id?t.getContact(n).then(function(t){e.emit("contacts.get.response",t)},function(e){console.log("error",e)}):t.getContacts(n).then(function(t){e.emit("contacts.get.response",t)},function(e){console.log("error",e)})}),e.on("contact.set",function(n){n&&"string"==typeof n.id&&t.setContactProps(n).then(function(t){e.emit("contact.set.response",t)},function(e){console.log("error",e)})}),e.on("contact.destroy",function(n){t.deleteContact(n).then(function(t){e.emit("contact.destroy.response",t)})})},e.prototype.socketOnCompanies=function(e,t){e.on("companies.get",function(){t.getCompanies().then(function(t){e.emit("companies.get.response",t)},function(e){console.log("error",e)})}),e.on("company.get",function(n){t.getCompany(n).then(function(t){e.emit("company.get.response",t)},function(e){console.log("error",e)})}),e.on("company.set",function(n){n.prop&&"string"==typeof n.id?t.setCompanyProp(n).then(function(t){e.emit("company.set.response",t)},function(e){console.log("error",e)}):n.props?t.setCompanyProps(n).then(function(t){e.emit("company.set.response",t)}):e.emit("company.set.response",{error:"Error: No payload or id"})}),e.on("company.create",function(n){t.createCompany(n).then(function(t){e.emit("company.create.response",t)})}),e.on("company.delete",function(n){t.deleteCompany(n).then(function(t){e.emit("company.delete.response",t)})})},e}();t.Endpoints=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DB_CONFIG={username:"rdev",password:"",database:"angular-bros-crm",host:"localhost",dialect:"sqlite",pool:{max:5,min:0,idle:1e4},storage:"./rdev.sql3"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),r=n(5),i=n(7),s=n(12),u=n(8),c=n(10),a=n(11),p=n(9),f=n(15),d=function(){function e(){this._dbConfig=r.DB_CONFIG,this.dbConfig(this._dbConfig),this.modelsInit()}return e.prototype.modelsInit=function(){this.User=s.userModel(o,this.sequelize),this.Company=i.companyModel(o,this.sequelize),this.Contact=u.contactModel(o,this.sequelize),this.Note=p.noteModel(o,this.sequelize),this.Quote=a.quoteModel(o,this.sequelize),this.QuoteLine=c.quoteLineModel(o,this.sequelize),this.User.hasMany(this.Company),this.Contact.belongsTo(this.Company,{foreignKey:{allowNull:!1}}),this.Contact.hasMany(this.Note),this.Note.belongsTo(this.Contact,{foreignKey:{allowNull:!1}}),this.Company.belongsTo(this.User),this.Company.hasMany(this.Contact,{foreignKey:{allowNull:!1}}),this.Company.hasMany(this.Quote),this.Quote.belongsTo(this.Company),this.Quote.hasMany(this.QuoteLine),this.QuoteLine.belongsTo(this.Quote)},e.prototype.dbConfig=function(e){this.sequelize=new o(e.database,e.username,e.password,{host:e.host,dialect:e.dialect,pool:{max:e.pool.max,min:e.pool.min,idle:e.pool.idle},storage:e.storage})},e.prototype.syncTable=function(){var e=this;this.sequelize.sync().then(function(){e.User.create({firstName:"Test",lastName:"Tester",email:"test@tester.com",role:"admin"})})},e.prototype.getUser=function(e){var t=this;return new Promise(function(n,o){t.User.findById(e.id).then(function(e){console.log("user ",e),n(e),o("error with find ID")})})},e.prototype.setUserProps=function(e){var t=this;return new Promise(function(n,o){t.User.findById(e.id).then(function(t){t.update(e.props).then(function(e){n(e),console.log("user set",e)},function(e){o("update error with"+e)}).catch(function(e){return console.log(e)})})})},e.prototype.createTestUser=function(){var e=this;return new Promise(function(t,n){e.sequelize.sync().then(function(e){return e.User.create({email:"test@tester.com",role:"general"})}).then(function(e){t(e),n("error with test user")})})},e.prototype.getCompany=function(e){var t=this;if(e)return new Promise(function(n,o){t.Company.findById(e.id).then(function(e){n(e),o("error with find ID")})})},e.prototype.getCompanies=function(){var e=this;return new Promise(function(t,n){e.Company.findAll({include:[e.Contact,e.Quote]}).then(function(e){t(e),n("error: no companies found")})})},e.prototype.setCompanyProp=function(e){var t=this;return new Promise(function(n,o){t.Company.findById(e.id).then(function(t){t.update((o={},o[e.prop.key]=e.prop.value,o)).then(function(e){n(e)}).catch(function(e){return console.log("ERROR : setCompanyProp",e)});var o},function(e){return o("Company set prop error :"+e)})})},e.prototype.setCompanyProps=function(e){var t=this;return new Promise(function(n,o){t.Company.findById(e.id).then(function(t){t.update(e.props).then(function(e){n(e)}).catch(function(e){return console.log("ERROR : setCompanyProp",e)})},function(e){return o("Company set prop error :"+e)})})},e.prototype.createCompany=function(e){var t=this;return new Promise(function(n,o){t.Company.create(e.props,{include:[t.Quote,t.Contact]}).then(function(e){n(e)},function(e){o("update error with"+e)})})},e.prototype.deleteCompany=function(e){var t=this;return console.log("payload",e),new Promise(function(n,o){t.Company.destroy({where:{id:e.id}}).then(function(e){n(e)},function(e){o("update error with"+e)})})},e.prototype.deleteContact=function(e){var t=this;return new Promise(function(n){t.Contact.destroy({where:{id:e.id}}).then(function(e){n(e)})})},e.prototype.getContact=function(e){var t=this;return new Promise(function(n,o){t.Contact.findById(e.id,{include:[t.Note]}).then(function(e){console.log("Contact instance ",e),n(e),o("error with find ID")})})},e.prototype.getContacts=function(e){var t=this;return new Promise(function(n,o){e.owner_id?t.Contact.findAll({where:{company_id:e.owner_id},include:[t.Note]}).then(function(e){console.log("CONTACTS INSTANCE",e),n(e)}):t.Contact.findAll({include:[t.Note]}).then(function(e){console.log("CONTACTS INSTANCE",e),n(e)},function(e){return o("error finding Contacts: "+e)})})},e.prototype.setContactProps=function(e){var t=this;return new Promise(function(n,o){t.Contact.findById(e.id).then(function(t){t.update(e.props).then(function(e){n(e)})},function(e){o("update error with: "+e)})})},e.prototype.createContact=function(e){var t=this;return new Promise(function(n,o){var r=Object.assign({},e.props,{company_id:e.owner_id});t.Contact.create(r).then(function(e){n(e)},function(e){o("update error with"+e)})})},e.prototype.getNote=function(e){var t=this;return new Promise(function(n,o){t.Note.findById(e.id).then(function(e){n(e),o("error: no notes found")})})},e.prototype.getNotes=function(e){var t=this;return new Promise(function(n,o){t.Note.findAll({where:{contact_id:e.owner_id}}).then(function(e){n(e),o("error: no notes found")})})},e.prototype.setNoteProp=function(e){var t=this;return console.log("notes payload",e),new Promise(function(n){t.Note.findById(e.id).then(function(t){t.update((o={},o[e.prop.key]=e.prop.value,o)).then(function(e){console.log("updated note with resposne: ",e),n(e)});var o})})},e.prototype.createNote=function(e){var t=this,n=Object.assign({},{contact_id:e.owner_id});return new Promise(function(e,o){t.Note.create(n).then(function(t){e(t)},function(e){o("update error with"+e)})})},e.prototype.destroyNote=function(e){var t=this;return new Promise(function(n){t.Note.destroy({where:{id:e.id}}).then(function(e){n(e)})})},e.prototype.getQuote=function(e){var t=this;return new Promise(function(n,o){t.Quote.findById(e.id,{include:[t.QuoteLine]}).then(function(e){n(e)},function(e){return o("error with find ID")})})},e.prototype.getQuotes=function(e){var t=this;return e.owner_id?new Promise(function(n,o){t.Quote.findAll({include:[t.QuoteLine],where:{company_id:e.owner_id}}).then(function(e){n(e)},function(e){return o("error with find ID")})}):new Promise(function(e,n){t.Quote.findAll({include:[t.QuoteLine]}).then(function(t){e(t)},function(e){return n("error with find ID")})})},e.prototype.setQuoteProps=function(e){var t=this;return new Promise(function(n,o){t.Quote.update(e.props,{where:{id:e.id}}).then(function(o){1==+o[0]&&t.Quote.findById(e.id,{include:[t.QuoteLine]}).then(function(e){n(e)})},function(e){o("update error with"+e)})})},e.prototype.setQuoteLineProps=function(e){var t=this;return new Promise(function(n,o){t.QuoteLine.update(e.props,{where:{id:e.id}}).then(function(e){n(e)})})},e.prototype.createQuote=function(e){var t=this,n=Object.assign({},e.props,{company_id:e.owner_id});return new Promise(function(e,o){t.Quote.create(n).then(function(t){e(t)},function(e){o("update error with"+e)})})},e.prototype.createQuoteLine=function(e){var t=this,n=f.merge({},e.props,{quote_id:e.owner_id});return new Promise(function(e){t.QuoteLine.create(n).then(function(t){e(t)})})},e.prototype.destroyQuote=function(e){var t=this;return new Promise(function(n){t.Quote.destroy({where:{id:e.id}}).then(function(e){n(e)})})},e.prototype.destroyQuoteLine=function(e){var t=this;return new Promise(function(n){t.QuoteLine.destroy({where:{id:e.id}}).then(function(e){n(e)})})},e}();t.CRMStoreManager=d},function(e,t,n){"use strict";function o(e,t){return t.define("company",{id:{type:e.UUID,primaryKey:!0,defaultValue:e.UUIDV4},name:{type:e.STRING},addressOne:{type:e.STRING},addressTwo:{type:e.STRING},city:{type:e.STRING},zip:{type:e.STRING},phone:{type:e.STRING},web:{type:e.STRING},fax:{type:e.STRING},misc:{type:e.STRING},created_at:{type:e.DATE,allowNull:!1},updated_at:e.DATE,deleted_at:e.DATE},{freezeTableName:!0,paranoid:!1,underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.companyModel=o},function(e,t,n){"use strict";function o(e,t){return t.define("contact",{id:{type:e.UUID,primaryKey:!0,defaultValue:e.UUIDV4},name:{type:e.STRING},phone:{type:e.STRING},email:{type:e.STRING},position:{type:e.STRING},created_at:{type:e.DATE,allowNull:!1},updated_at:e.DATE,deleted_at:e.DATE},{freezeTableName:!0,paranoid:!1,underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.contactModel=o},function(e,t,n){"use strict";function o(e,t){return t.define("note",{id:{type:e.UUID,primaryKey:!0,defaultValue:e.UUIDV4},name:{type:e.STRING},title:{type:e.STRING},text:{type:e.STRING},created_at:{type:e.DATE,allowNull:!1},updated_at:e.DATE,deleted_at:e.DATE},{freezeTableName:!0,paranoid:!1,underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.noteModel=o},function(e,t,n){"use strict";function o(e,t){return t.define("quoteLine",{id:{type:e.UUID,primaryKey:!0,defaultValue:e.UUIDV4},name:{type:e.STRING},weight:{type:e.DOUBLE},isCentered:{type:e.BOOLEAN},unit:{type:e.STRING},cost:{type:e.FLOAT},desc:{type:e.STRING},created_at:{type:e.DATE,allowNull:!1},updated_at:e.DATE,deleted_at:e.DATE},{freezeTableName:!0,paranoid:!1,underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.quoteLineModel=o},function(e,t,n){"use strict";function o(e,t){return t.define("quote",{id:{type:e.UUID,primaryKey:!0,defaultValue:e.UUIDV4},name:{type:e.STRING},created_at:{type:e.DATE,allowNull:!1},updated_at:e.DATE,deleted_at:e.DATE},{freezeTableName:!0,paranoid:!1,underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.quoteModel=o},function(e,t,n){"use strict";function o(e,t){return t.define("user",{id:{type:e.UUID,primaryKey:!0,defaultValue:e.UUIDV4},firstName:{type:e.STRING},lastName:{type:e.STRING},passHash:{type:e.STRING},role:{type:e.ENUM,values:["general","blocked","admin","removed"],required:!0},email:{type:e.STRING,required:!0},addressOne:{type:e.STRING},addressTwo:{type:e.STRING},phone:{type:e.STRING},businessName:{type:e.STRING},businessWeb:{type:e.STRING},businessPhone:{type:e.STRING},businessFax:{type:e.STRING},created_at:{type:e.DATE,allowNull:!1},updated_at:e.DATE,deleted_at:e.DATE},{freezeTableName:!0,paranoid:!1,underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.userModel=o},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("sendgrid")},function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=require("socket.io")},function(e,t,n){e.exports=n(0)}]);
//# sourceMappingURL=main.map
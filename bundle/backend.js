!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=15)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1);!function(){o.Server.bootstrap()}()},function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),i=n(11),s=n(14),u=n(4),a=n(3),c=n(2),p=function(e){function t(){var t=e.call(this)||this;return t.port=1729,t.app=i(),t.config(),t.endPoints(),t}return o(t,e),t.bootstrap=function(){return new t},t.prototype.config=function(){this.server=r.createServer(this.app),console.log("listening on port "+this.port),this.server.listen(this.port),this.IO=s(this.server),this.crmStoreManager=new u.CRMStoreManager(a.dbConfig)},t.prototype.endPoints=function(){var e=this;this.IO.on("connection",function(t){e.socketOnCompanies(t,e.crmStoreManager),e.socketOnQuotes(t,e.crmStoreManager),e.socketOnContacts(t,e.crmStoreManager),e.socketOnUsers(t,e.crmStoreManager),e.socketOnNotes(t,e.crmStoreManager),t.on("user.test.create",function(){e.crmStoreManager.createTestUser().then(function(e){t.emit("user.test.create.response",e)})})})},t}(c.Endpoints);t.Server=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.socketOnNotes=function(e,t){e.on("note.create",function(n){if(console.log("note.get",n),n.hasOwnProperty("id")){var o=n.id;t.getnote(o).then(function(t){e.emit("note.get.response",t)})}else e.emit("note.get.response",{error:"No ID in payload"})}),e.on("note.get",function(n){if(console.log("note.get",n),n.hasOwnProperty("id")){var o=n.id;t.getNote(o).then(function(t){e.emit("note.get.response",t)})}else e.emit("note.get.response",{error:"No ID in payload"})}),e.on("note.set",function(n){t.setNoteProp(n.id,n.prop).then(function(t){e.emit("note.set.response",t)})})},e.prototype.socketOnUsers=function(e,t){e.on("user.get",function(n){if(console.log("user.get",n),n.hasOwnProperty("id")){var o=n.id;t.getUser(o).then(function(t){e.emit("user.get.response",t)})}else e.emit("user.get.response",{error:"No ID in payload"})}),e.on("user.get",function(n){if(console.log("user.get",n),n.hasOwnProperty("id")){var o=n.id;t.getUser(o).then(function(t){e.emit("user.get.response",t)})}else e.emit("user.get.response",{error:"No ID in payload"})}),e.on("user.set",function(n){t.setUserProp(n.id,n.prop).then(function(t){e.emit("user.set.response",t)})})},e.prototype.socketOnQuotes=function(e,t){e.on("quote.create",function(n){console.log("payload 0",n.quoteProp),t.createQuotes(n.props).then(function(t){e.emit("quotes.post.response",t)})}),e.on("quotes.get",function(n){console.log("payload 0quotes get",n),t.getQuotes(n).then(function(t){console.log("hit response 96"),e.emit("quotes.get.response",t)})}),e.on("quotes.post",function(n){n?(console.log("payload 0",n),t.createQuotes(n).then(function(t){e.emit("quotes.post.response",t)})):t.createQuotes(n.quoteProps).then(function(t){e.emit("quotes.post.response",t)}),e.on("quoteLines.post",function(n){t.createQuotes(n).then(function(t){e.emit("quoteLines.post.response",t)})})})},e.prototype.socketOnContacts=function(e,t){e.on("contacts.create",function(n){t.createContacts(n).then(function(t){e.emit("contacts.create.response",t)})}),e.on("contacts.get",function(n){n?t.getContacts(n.id).then(function(t){e.emit("contacts.get.response",n)}):t.getContacts().then(function(t){e.emit("contacts.get.response",n)})}),e.on("contacts.post",function(n){t.setContactsProp(n.id,n.prop).then(function(t){console.log("payload 0",n),e.emit("contacts.post.response",t)})})},e.prototype.socketOnCompanies=function(e,t){e.on("companies.get",function(n){console.log("COMPANIES",n),n?t.getCompanies(n.id).then(function(t){e.emit("companies.get.response",t)},function(e){console.log("error",e)}):t.getCompanies().then(function(t){e.emit("companies.get.response",t)},function(e){console.log("error",e)})}),e.on("companies.post",function(n){t.setCompaniesProp(n.id,n.prop).then(function(t){e.emit("companies.post.response",t)})}),e.on("companies.create",function(n){t.createCompany(n).then(function(t){e.emit("companies.create.response",t)})})},e}();t.Endpoints=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dbConfig={username:"rdev",password:"",database:"angular-bros-crm",host:"localhost",dialect:"sqlite",pool:{max:5,min:0,idle:1e4},storage:"./rdev.sql3"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(13),r=n(10),i=n(5),s=n(6),u=n(8),a=n(9),c=n(7),p=function(){function e(e){this.config=e,this.dbConfig(),this.modelsInit()}return e.prototype.syncTable=function(){var e=this;this.sequelize.sync().then(function(){e.User.create({firstName:"Test",lastName:"Tester",email:"test@tester.com",role:"admin"},{})})},e.prototype.createTestUser=function(){var e=this;return new Promise(function(t,n){e.sequelize.sync().then(function(e){return e.User.create({email:"test@tester.com",role:"general"})}).then(function(e){t(e),n("error with test user")})})},e.prototype.modelsInit=function(){this.User=r.userModel(o,this.sequelize),this.Company=i.companyModel(o,this.sequelize),this.Contact=s.contactModel(o,this.sequelize),this.Note=c.noteModel(o,this.sequelize),this.Quote=a.quoteModel(o,this.sequelize),this.QuoteLine=u.quoteLineModel(o,this.sequelize),this.User.hasMany(this.Company),this.Contact.belongsTo(this.Company),this.Contact.hasMany(this.Note),this.Company.belongsTo(this.User),this.Company.hasMany(this.Contact),this.Company.hasMany(this.Quote),this.Quote.belongsTo(this.Company),this.Quote.hasMany(this.QuoteLine),this.QuoteLine.belongsTo(this.Quote)},e.prototype.dbConfig=function(){this.sequelize=new o(this.config.database,this.config.username,this.config.password,{host:this.config.host,dialect:this.config.dialect,pool:{max:this.config.pool.max,min:this.config.pool.min,idle:this.config.pool.idle},storage:this.config.storage})},e.prototype.getUser=function(e){var t=this;return console.log("??",e),new Promise(function(n,o){t.User.findById(e).then(function(e){n(e.dataValues),o("error with find ID")})})},e.prototype.setUserProp=function(e,t){var n=this;return new Promise(function(o,r){n.User.findById(e).then(function(e){o(e.update((n={},n[t.key]=t.value,n)));var n},function(e){r("update error with"+e)})})},e.prototype.getCompanies=function(e){var t=this;return console.log("get companies"),e?new Promise(function(n,o){t.Company.findById(e).then(function(e){e&&e.dataValues.id?n(e.dataValues):o("error with find ID")})}):new Promise(function(e,n){t.Company.findAll({include:[t.Contact,t.Quote]}).then(function(t){console.log("company",t),e(t),n("error: no companies found")})})},e.prototype.setCompaniesProp=function(e,t){var n=this;return new Promise(function(o,r){n.Company.findById(e).then(function(e){console.log("found company",e),o(e.update((n={},n[t.key]=t.value,n)));var n},function(e){r("update error with"+e)})})},e.prototype.createCompany=function(e){var t=this;return new Promise(function(n,o){t.Company.create(e).then(function(e){console.log(e),n(e.dataValues)},function(e){o("update error with"+e)})})},e.prototype.getContacts=function(e){var t=this;return e?new Promise(function(n,o){t.Contact.findById(e).then(function(e){e&&e.dataValues.id?n(e.dataValues):o("error with find ID")})}):new Promise(function(e,n){t.Contact.findAll().then(function(t){t.length>0?e(t):n("error: no contacts found")})})},e.prototype.setContactsProp=function(e,t){var n=this;return new Promise(function(o,r){n.Contact.findById(e).then(function(e){console.log("found contact",e),o(e.update((n={},n[t.key]=t.value,n)));var n},function(e){r("update error with"+e)})})},e.prototype.createContacts=function(e){var t=this;return new Promise(function(n,o){t.Contact.create(e).then(function(e){n(e)},function(e){o("update error with"+e)})})},e.prototype.getNotes=function(e){var t=this;return e?new Promise(function(n,o){t.Note.findById(e).then(function(e){e&&e.dataValues.id?n(e.dataValues):o("error with find ID")})}):new Promise(function(e,n){t.Note.findAll().then(function(t){t.length>0?e(t):n("error: no notes found")})})},e.prototype.setNoteProp=function(e,t){var n=this;return new Promise(function(o,r){n.Note.findById(e).then(function(e){console.log("found note",e),o(e.update((n={},n[t.key]=t.value,n)));var n},function(e){r("update error with"+e)})})},e.prototype.createNotes=function(e){var t=this;return new Promise(function(n,o){t.Note.create(e).then(function(e){n(e)},function(e){o("update error with"+e)})})},e.prototype.getQuotes=function(e){var t=this;return e.id?new Promise(function(n,o){t.Quote.findById(e.id,{include:[t.QuoteLine]}).then(function(e){e&&e.dataValues.id?n(e.dataValues):o("error with find ID")})}):new Promise(function(e){t.Quote.findAll({include:[t.QuoteLine]}).then(function(t){console.log("find all",t),e(t)})})},e.prototype.setQuotesProp=function(e,t){var n=this;return new Promise(function(o,r){n.Quote.findById(e).then(function(e){console.log("found quote",e),o(e.update((n={},n[t.key]=t.value,n)));var n},function(e){r("update error with"+e)})})},e.prototype.createQuotes=function(e){var t=this;return new Promise(function(n,o){t.Quote.create(e).then(function(e){n(e)},function(e){o("update error with"+e)})})},e.prototype.createQuoteLine=function(e,t){var n=this;return new Promise(function(o,r){n.Quote.findById(e).then(function(e){e.QuoteLine.create(t).then(function(e){o(e)})},function(e){r("update error with"+e)})})},e}();t.CRMStoreManager=p},function(e,t,n){"use strict";function o(e,t){return t.define("company",{id:{type:e.UUID,primaryKey:!0,defaultValue:e.UUIDV4},name:{type:e.STRING},addressOne:{type:e.STRING},addressTwo:{type:e.STRING},city:{type:e.STRING},zip:{type:e.STRING},phone:{type:e.STRING},web:{type:e.STRING},fax:{type:e.STRING},misc:{type:e.STRING},created_at:{type:e.DATE,allowNull:!1},updated_at:e.DATE,deleted_at:e.DATE},{freezeTableName:!0,paranoid:!1,underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.companyModel=o},function(e,t,n){"use strict";function o(e,t){return t.define("contact",{id:{type:e.UUID,primaryKey:!0,defaultValue:e.UUIDV4},name:{type:e.STRING},phone:{type:e.STRING},email:{type:e.STRING},position:{type:e.STRING},created_at:{type:e.DATE,allowNull:!1},updated_at:e.DATE,deleted_at:e.DATE},{freezeTableName:!0,paranoid:!1,underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.contactModel=o},function(e,t,n){"use strict";function o(e,t){return t.define("note",{id:{type:e.UUID,primaryKey:!0,defaultValue:e.UUIDV4},title:{type:e.STRING},text:{type:e.STRING},created_at:{type:e.DATE,allowNull:!1},updated_at:e.DATE,deleted_at:e.DATE},{freezeTableName:!0,paranoid:!1,underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.noteModel=o},function(e,t,n){"use strict";function o(e,t){return t.define("quoteLine",{id:{type:e.UUID,primaryKey:!0,defaultValue:e.UUIDV4},name:{type:e.STRING},weight:{type:e.DOUBLE},isCentered:{type:e.BOOLEAN},unit:{type:e.STRING},cost:{type:e.FLOAT},desc:{type:e.STRING},created_at:{type:e.DATE,allowNull:!1},updated_at:e.DATE,deleted_at:e.DATE},{freezeTableName:!0,paranoid:!1,underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.quoteLineModel=o},function(e,t,n){"use strict";function o(e,t){return t.define("quote",{id:{type:e.UUID,primaryKey:!0,defaultValue:e.UUIDV4},name:{type:e.STRING},created_at:{type:e.DATE,allowNull:!1},updated_at:e.DATE,deleted_at:e.DATE},{freezeTableName:!0,paranoid:!1,underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.quoteModel=o},function(e,t,n){"use strict";function o(e,t){return t.define("user",{id:{type:e.UUID,primaryKey:!0,defaultValue:e.UUIDV4},firstName:{type:e.STRING},lastName:{type:e.STRING},passHash:{type:e.STRING},role:{type:e.ENUM,values:["general","blocked","admin","removed"],required:!0},email:{type:e.STRING,required:!0},addressOne:{type:e.STRING},addressTwo:{type:e.STRING},phone:{type:e.STRING},businessName:{type:e.STRING},businessWeb:{type:e.STRING},businessPhone:{type:e.STRING},businessFax:{type:e.STRING},created_at:{type:e.DATE,allowNull:!1},updated_at:e.DATE,deleted_at:e.DATE},{freezeTableName:!0,paranoid:!1,underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.userModel=o},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=require("socket.io")},function(e,t,n){e.exports=n(0)}]);
//# sourceMappingURL=main.map
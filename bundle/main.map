{"version":3,"sources":["webpack:///backend.js","webpack:///webpack/bootstrap e033b3e4c8558bc6529b","webpack:///./src/main.ts","webpack:///./src/app.ts","webpack:///./src/orm/config.ts","webpack:///./src/orm/store-manager.ts","webpack:///./src/orm/table-models/user.table-model.ts","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///external \"sequelize\"","webpack:///external \"socket.io\""],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","app_1","Server","bootstrap","http","express","Socketio","store_manager_1","config_1","this","app","config","endPoints","server","createServer","console","log","IO","listen","crmStoreManager","CRMStoreManager","dbConfig","_this","on","socket","payload","getUser","id","then","user","emit","response","setUserProp","prop","username","password","database","host","dialect","pool","max","min","idle","storage","sequelizeStatic","user_table_model_1","modelsInit","syncTable","sequelize","sync","instance","User","userModel","Promise","resolve","reject","findById","userInstance","dataValues","update","_a","key","error","Error","DataTypes","sequlize","define","type","UUID","primaryKey","defaultValue","UUIDV4","firstName","STRING","lastName","passHash","role","ENUM","values","required","email","addressOne","addressTwo","phone","businessName","businessWeb","businessPhone","businessFax","created_at","DATE","allowNull","updated_at","deleted_at","freezeTableName","paranoid","underscored","require"],"mappings":"CAAS,SAAUA,GCInB,QAAAC,GAAAC,GAGA,GAAAC,EAAAD,GACA,MAAAC,GAAAD,GAAAE,OAGA,IAAAC,GAAAF,EAAAD,IACAI,EAAAJ,EACAK,GAAA,EACAH,WAUA,OANAJ,GAAAE,GAAAM,KAAAH,EAAAD,QAAAC,IAAAD,QAAAH,GAGAI,EAAAE,GAAA,EAGAF,EAAAD,QAvBA,GAAAD,KA4BAF,GAAAQ,EAAAT,EAGAC,EAAAS,EAAAP,EAGAF,EAAAK,EAAA,SAAAK,GAA2C,MAAAA,IAG3CV,EAAAW,EAAA,SAAAR,EAAAS,EAAAC,GACAb,EAAAc,EAAAX,EAAAS,IACAG,OAAAC,eAAAb,EAAAS,GACAK,cAAA,EACAC,YAAA,EACAC,IAAAN,KAMAb,EAAAoB,EAAA,SAAAhB,GACA,GAAAS,GAAAT,KAAAiB,WACA,WAA2B,MAAAjB,GAAA,SAC3B,WAAiC,MAAAA,GAEjC,OADAJ,GAAAW,EAAAE,EAAA,IAAAA,GACAA,GAIAb,EAAAc,EAAA,SAAAQ,EAAAC,GAAsD,MAAAR,QAAAS,UAAAC,eAAAlB,KAAAe,EAAAC,IAGtDvB,EAAA0B,EAAA,GAGA1B,IAAA2B,EAAA,KDMM,SAAUvB,EAAQD,EAASH,GAEjC,YAEAe,QAAOC,eAAeb,EAAS,cAAgBO,OAAO,GE1EtD,IAAAkB,GAAA5B,EAAA,IAEA,WACC4B,EAAAC,OAAOC,gBFiFF,SAAU1B,EAAQD,EAASH,GAEjC,YAEAe,QAAOC,eAAeb,EAAS,cAAgBO,OAAO,GGxFtD,IAAAqB,GAAA/B,EAAA,GACAgC,EAAAhC,EAAA,GACAiC,EAAAjC,EAAA,GACAkC,EAAAlC,EAAA,GAEAmC,EAAAnC,EAAA,GAEA6B,EAAA,WAUC,QAAAA,KACCO,KAAKC,IAAML,IACXI,KAAKE,SACLF,KAAKG,YAqCP,MA5CeV,GAAAC,UAAd,WACC,MAAO,IAAID,IASJA,EAAAL,UAAAc,OAAR,WACCF,KAAKI,OAAST,EAAKU,aAAaL,KAAKC,KACrCK,QAAQC,IAAI,8BACZP,KAAKQ,GAAKX,EAASG,KAAKI,QACxBJ,KAAKI,OAAOK,OAAO,MACnBT,KAAKU,gBAAkB,GAAIZ,GAAAa,gBAAgBZ,EAAAa,WAGpCnB,EAAAL,UAAAe,UAAR,cAAAU,GAAAb,IACCA,MAAKQ,GAAGM,GAAG,aAAc,SAAAC,GACxBA,EAAOD,GAAG,WAAY,SAAAE,GACrBV,QAAQC,IAAIS,GACZH,EAAKH,gBACHO,QAAQD,EAAQE,IAChBC,KAAK,SAAAC,GACLL,EAAOM,KAAK,oBAAsBD,MAElC,SAAAE,GACFhB,QAAQC,IAAI,OAAQe,KAErBP,EAAOM,KAAK,iBAAkB,UAC9BN,EAAOD,GAAG,WAAY,SAAAE,GACrBV,QAAQC,IAAI,YAAaS,GACzBH,EAAKH,gBACHa,YAAYP,EAAQE,GAAIF,EAAQQ,MAChCL,KAAK,SAAAG,GACLP,EAAOM,KAAK,oBAAqBC,OAGpCP,EAAOD,GAAG,aAAc,WACvBR,QAAQC,IAAI,aAIhBd,IAlDa1B,GAAA0B,UHyIP,SAAUzB,EAAQD,EAASH,GAEjC,YAEAe,QAAOC,eAAeb,EAAS,cAAgBO,OAAO,IItIzCP,EAAA6C,UACZa,SAAU,OACVC,SAAU,GACVC,SAAU,mBACVC,KAAM,YACNC,QAAS,SACTC,MACCC,IAAK,EACLC,IAAK,EACLC,KAAM,KAEPC,QAAS,gBJ6IJ,SAAUlE,EAAQD,EAASH,GAEjC,YAEAe,QAAOC,eAAeb,EAAS,cAAgBO,OAAO,GK1KtD,IAAA6D,GAAAvE,EAAA,GAEAwE,EAAAxE,EAAA,GAYA+C,EAAA,WAIC,QAAAA,GAAoBT,GAAAF,KAAAE,SACnBF,KAAKY,WACLZ,KAAKqC,aA0FP,MAvFS1B,GAAAvB,UAAAkD,UAAR,WACCtC,KAAKuC,UAAUC,OAAOrB,KAAK,SAACsB,GAC3BnC,QAAQC,IAAIkC,MAIN9B,EAAAvB,UAAAiD,WAAR,WACCrC,KAAK0C,KAAON,EAAAO,UAAUR,EAAiBnC,KAAKuC,YAKrC5B,EAAAvB,UAAAwB,SAAR,WACCZ,KAAKuC,UAAY,GAAIJ,GAAgBnC,KAAKE,OAAOyB,SAAU3B,KAAKE,OAAOuB,SAAUzB,KAAKE,OAAOwB,UAC5FE,KAAM5B,KAAKE,OAAO0B,KAClBC,QAAS7B,KAAKE,OAAO2B,QACrBC,MACCC,IAAK/B,KAAKE,OAAO4B,KAAKC,IACtBC,IAAKhC,KAAKE,OAAO4B,KAAKE,IACtBC,KAAMjC,KAAKE,OAAO4B,KAAKG,MAExBC,QAASlC,KAAKE,OAAOgC,WAIhBvB,EAAAvB,UAAA6B,QAAP,SAAeC,GAAf,GAAAL,GAAAb,IACC,OAAO,IAAI4C,SAAQ,SAACC,EAASC,GAC5BjC,EAAK6B,KAAKK,SAAS7B,GAAIC,KAAK,SAAC6B,GACxBA,EAAaC,WAAW/B,GAC3B2B,EAAQG,EAAaC,YAErBH,EAAOE,QAMJrC,EAAAvB,UAAAmC,YAAP,SAAmBL,EAAIM,GAAvB,GAAAX,GAAAb,IACC,OAAO,IAAI4C,SAAQ,SAACC,EAASC,GAC5BjC,EAAK6B,KAAKK,SAAS7B,GAAIC,KAAK,SAAA6B,GAC3B1C,QAAQC,IAAI,aAAcyC,GAC1BH,EAAQG,EAAaE,QAAMC,KAC1BA,EAAC3B,EAAK4B,KAAK5B,EAAKlD,ML4JD6E,IACJ,IAAIA,IK3Jd,SAAAE,GAEFP,EAAO,GAAIQ,OAAM,oBAAsBD,SAyC3C1C,IAhGa5C,GAAA4C,mBL8NP,SAAU3C,EAAQD,EAASH,GAEjC,YM9OA,SAAA+E,GAA0BY,EAAWC,GACpC,MAAOA,GAASC,OAAO,QACtBvC,IACCwC,KAAMH,EAAUI,KAChBC,YAAY,EACZC,aAAcN,EAAUO,QAEzBC,WACCL,KAAMH,EAAUS,QAEjBC,UACCP,KAAMH,EAAUS,QAEjBE,UACCR,KAAMH,EAAUS,QAEjBG,MACCT,KAAMH,EAAUa,KAChBC,QAAS,UAAW,UAAW,QAAS,WACxCC,UAAU,GAEXC,OACCb,KAAMH,EAAUS,OAChBM,UAAU,GAEXE,YACCd,KAAMH,EAAUS,QAEjBS,YACCf,KAAMH,EAAUS,QAEjBU,OACChB,KAAMH,EAAUS,QAEjBW,cACCjB,KAAMH,EAAUS,QAEjBY,aACClB,KAAMH,EAAUS,QAEjBa,eACCnB,KAAMH,EAAUS,QAEjBc,aACCpB,KAAMH,EAAUS,QAEjBe,YACCrB,KAAMH,EAAUyB,KAChBC,WAAW,GAEZC,WAAY3B,EAAUyB,KACtBG,WAAY5B,EAAUyB,OAEtBI,iBAAiB,EACjBC,UAAU,EACVC,aAAa,INyLf3G,OAAOC,eAAeb,EAAS,cAAgBO,OAAO,IMhPtDP,EAAA4E,aNgTM,SAAU3E,EAAQD,GOhTxBC,EAAAD,QAAAwH,QAAA,YPsTM,SAAUvH,EAAQD,GQtTxBC,EAAAD,QAAAwH,QAAA,SR4TM,SAAUvH,EAAQD,GS5TxBC,EAAAD,QAAAwH,QAAA,cTkUM,SAAUvH,EAAQD,GUlUxBC,EAAAD,QAAAwH,QAAA,cVwUM,SAAUvH,EAAQD,EAASH,GAEjCI,EAAOD,QAAUH,EAAoB","file":"backend.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 9);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar app_1 = __webpack_require__(1);\r\nfunction boot() {\r\n    app_1.Server.bootstrap();\r\n}\r\nboot();\r\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar http = __webpack_require__(6);\r\nvar express = __webpack_require__(5);\r\nvar Socketio = __webpack_require__(8);\r\nvar store_manager_1 = __webpack_require__(3);\r\nvar config_1 = __webpack_require__(2);\r\nvar Server = (function () {\r\n    function Server() {\r\n        this.app = express();\r\n        this.config();\r\n        this.endPoints();\r\n    }\r\n    Server.bootstrap = function () {\r\n        return new Server();\r\n    };\r\n    Server.prototype.config = function () {\r\n        this.server = http.createServer(this.app);\r\n        console.log('listening on port Taxi Cab');\r\n        this.IO = Socketio(this.server);\r\n        this.server.listen(1729);\r\n        this.crmStoreManager = new store_manager_1.CRMStoreManager(config_1.dbConfig);\r\n    };\r\n    Server.prototype.endPoints = function () {\r\n        var _this = this;\r\n        this.IO.on('connection', function (socket) {\r\n            socket.on('user.get', function (payload) {\r\n                console.log(payload);\r\n                _this.crmStoreManager\r\n                    .getUser(payload.id)\r\n                    .then(function (user) {\r\n                    socket.emit('user.get.response', user);\r\n                });\r\n            }, function (response) {\r\n                console.log('ack?', response);\r\n            });\r\n            socket.emit('user.response', ['three']);\r\n            socket.on('user.set', function (payload) {\r\n                console.log('on hit 43', payload);\r\n                _this.crmStoreManager\r\n                    .setUserProp(payload.id, payload.prop)\r\n                    .then(function (response) {\r\n                    socket.emit('user.set.response', response);\r\n                });\r\n            });\r\n            socket.on('disconnect', function () {\r\n                console.log('dc\\'d');\r\n            });\r\n        });\r\n    };\r\n    return Server;\r\n}());\r\nexports.Server = Server;\r\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.dbConfig = {\r\n    username: 'rdev',\r\n    password: '',\r\n    database: 'angular-bros-crm',\r\n    host: 'localhost',\r\n    dialect: 'sqlite',\r\n    pool: {\r\n        max: 5,\r\n        min: 0,\r\n        idle: 10000\r\n    },\r\n    storage: './rdev.sql3'\r\n};\r\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar sequelizeStatic = __webpack_require__(7);\r\nvar user_table_model_1 = __webpack_require__(4);\r\nvar CRMStoreManager = (function () {\r\n    function CRMStoreManager(config) {\r\n        this.config = config;\r\n        this.dbConfig();\r\n        this.modelsInit();\r\n    }\r\n    CRMStoreManager.prototype.syncTable = function () {\r\n        this.sequelize.sync().then(function (instance) {\r\n            console.log(instance);\r\n        });\r\n    };\r\n    CRMStoreManager.prototype.modelsInit = function () {\r\n        this.User = user_table_model_1.userModel(sequelizeStatic, this.sequelize);\r\n        // this.Contact = contactModel(sequelizeStatic, this.sequelize);\r\n        // this.Resume.hasOne(this.Experience);\r\n    };\r\n    CRMStoreManager.prototype.dbConfig = function () {\r\n        this.sequelize = new sequelizeStatic(this.config.database, this.config.username, this.config.password, {\r\n            host: this.config.host,\r\n            dialect: this.config.dialect,\r\n            pool: {\r\n                max: this.config.pool.max,\r\n                min: this.config.pool.min,\r\n                idle: this.config.pool.idle\r\n            },\r\n            storage: this.config.storage\r\n        });\r\n    };\r\n    CRMStoreManager.prototype.getUser = function (id) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.User.findById(id).then(function (userInstance) {\r\n                if (userInstance.dataValues.id) {\r\n                    resolve(userInstance.dataValues);\r\n                }\r\n                else {\r\n                    reject(userInstance);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    CRMStoreManager.prototype.setUserProp = function (id, prop) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.User.findById(id).then(function (userInstance) {\r\n                console.log('found user', userInstance);\r\n                resolve(userInstance.update((_a = {},\r\n                    _a[prop.key] = prop.value,\r\n                    _a)));\r\n                var _a;\r\n            }, function (error) {\r\n                //todo will it break??\r\n                reject(new Error('update error with' + error));\r\n            });\r\n        });\r\n    };\r\n    return CRMStoreManager;\r\n}());\r\nexports.CRMStoreManager = CRMStoreManager;\r\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction userModel(DataTypes, sequlize) {\r\n    return sequlize.define('user', {\r\n        id: {\r\n            type: DataTypes.UUID,\r\n            primaryKey: true,\r\n            defaultValue: DataTypes.UUIDV4\r\n        },\r\n        firstName: {\r\n            type: DataTypes.STRING,\r\n        },\r\n        lastName: {\r\n            type: DataTypes.STRING,\r\n        },\r\n        passHash: {\r\n            type: DataTypes.STRING,\r\n        },\r\n        role: {\r\n            type: DataTypes.ENUM,\r\n            values: ['general', 'blocked', 'admin', 'removed'],\r\n            required: true\r\n        },\r\n        email: {\r\n            type: DataTypes.STRING,\r\n            required: true\r\n        },\r\n        addressOne: {\r\n            type: DataTypes.STRING\r\n        },\r\n        addressTwo: {\r\n            type: DataTypes.STRING\r\n        },\r\n        phone: {\r\n            type: DataTypes.STRING\r\n        },\r\n        businessName: {\r\n            type: DataTypes.STRING\r\n        },\r\n        businessWeb: {\r\n            type: DataTypes.STRING\r\n        },\r\n        businessPhone: {\r\n            type: DataTypes.STRING\r\n        },\r\n        businessFax: {\r\n            type: DataTypes.STRING\r\n        },\r\n        created_at: {\r\n            type: DataTypes.DATE,\r\n            allowNull: false\r\n        },\r\n        updated_at: DataTypes.DATE,\r\n        deleted_at: DataTypes.DATE\r\n    }, {\r\n        freezeTableName: true,\r\n        paranoid: false,\r\n        underscored: true,\r\n    });\r\n}\r\nexports.userModel = userModel;\r\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"express\");\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"http\");\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"sequelize\");\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"socket.io\");\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(0);\n\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// backend.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e033b3e4c8558bc6529b","import {Server} from './app';\n\nfunction boot() {\n\tServer.bootstrap();\n}\n\nboot();\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.ts","import * as http from 'http';\nimport * as express from 'express';\nimport * as Socketio from 'socket.io';\nimport {CRMStoreManager} from './orm/store-manager';\nimport {ResponseObject} from './models/response-object.model';\nimport {dbConfig} from './orm/config';\n\nexport class Server {\n\tprivate app: express.Application;\n\tprivate server;\n\tprivate IO;\n\tprivate crmStoreManager: CRMStoreManager;\n\n\tpublic static bootstrap(): Server {\n\t\treturn new Server();\n\t}\n\n\tconstructor(){\n\t\tthis.app = express();\n\t\tthis.config();\n\t\tthis.endPoints();\n\t}\n\n\tprivate config(): void {\n\t\tthis.server = http.createServer(this.app);\n\t\tconsole.log('listening on port Taxi Cab');\n\t\tthis.IO = Socketio(this.server);\n\t\tthis.server.listen(1729);\n\t\tthis.crmStoreManager = new CRMStoreManager(dbConfig);\n\t}\n\n\tprivate endPoints(): void {\n\t\tthis.IO.on('connection', socket => {\n\t\t\tsocket.on('user.get', payload => {\n\t\t\t\tconsole.log(payload);\n\t\t\t\tthis.crmStoreManager\n\t\t\t\t\t.getUser(payload.id)\n\t\t\t\t\t.then(user => {\n\t\t\t\t\t\tsocket.emit('user.get.response' , user);\n\t\t\t\t\t});\n\t\t\t}, response => {\n\t\t\t\tconsole.log('ack?', response);\n\t\t\t});\n\t\t\tsocket.emit('user.response', ['three']);\n\t\t\tsocket.on('user.set', payload => {\n\t\t\t\tconsole.log('on hit 43', payload);\n\t\t\t\tthis.crmStoreManager\n\t\t\t\t\t.setUserProp(payload.id, payload.prop)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tsocket.emit('user.set.response', response);\n\t\t\t\t})\n\t\t\t});\n\t\t\tsocket.on('disconnect', ()=> {\n\t\t\t\tconsole.log('dc\\'d');\n\t\t\t})\n\t\t});\n\t}\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app.ts","export interface DBConfig {\n\tusername: string;\n\tpassword: string;\n\tdatabase: string;\n\thost: string;\n\tdialect: string;\n\tpool: {\n\t\tmax: number,\n\t\tmin: number,\n\t\tidle: number\n\t}\n\tstorage: string;\n}\n\nexport const dbConfig = {\n\tusername: 'rdev',\n\tpassword: '',\n\tdatabase: 'angular-bros-crm',\n\thost: 'localhost',\n\tdialect: 'sqlite',\n\tpool: {\n\t\tmax: 5,\n\t\tmin: 0,\n\t\tidle: 10000\n\t},\n\tstorage: './rdev.sql3'\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/orm/config.ts","import * as sequelizeStatic from 'sequelize';\nimport {DBConfig} from './config';\nimport {userModel} from './table-models/user.table-model';\nimport {UserAttributes, UserModel} from './table-models/attributes/user.attributes';\nimport {error} from 'util';\n\nexport interface StoreManager {\n\tgetUser(id: string): Promise<any>;\n\t// getUserState(): Promise<any>;\n\tsetUserProp(id: string, prop: string | number): Promise<any>;\n\t// registerUser(user: UserAttributes): void;\n\t// deleteUser(): Promise<any>;\n}\n\nexport class CRMStoreManager implements StoreManager {\n\tpublic sequelize: sequelizeStatic.Sequelize;\n\tpublic User: UserModel;\n\n\tconstructor(private config: DBConfig) {\n\t\tthis.dbConfig();\n\t\tthis.modelsInit();\n\t}\n\n\tprivate syncTable(): void {\n\t\tthis.sequelize.sync().then((instance: any) => {\n\t\t\tconsole.log(instance);\n\t\t})\n\t}\n\n\tprivate modelsInit(): void {\n\t\tthis.User = userModel(sequelizeStatic, this.sequelize);\n\t\t// this.Contact = contactModel(sequelizeStatic, this.sequelize);\n\t\t// this.Resume.hasOne(this.Experience);\n\t}\n\n\tprivate dbConfig(): void {\n\t\tthis.sequelize = new sequelizeStatic(this.config.database, this.config.username, this.config.password, {\n\t\t\thost: this.config.host,\n\t\t\tdialect: this.config.dialect,\n\t\t\tpool: {\n\t\t\t\tmax: this.config.pool.max,\n\t\t\t\tmin: this.config.pool.min,\n\t\t\t\tidle: this.config.pool.idle\n\t\t\t},\n\t\t\tstorage: this.config.storage\n\t\t});\n\t}\n\n\tpublic getUser(id): Promise<any> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.User.findById(id).then((userInstance: any) => {\n\t\t\t\tif (userInstance.dataValues.id) {\n\t\t\t\t\tresolve(userInstance.dataValues);\n\t\t\t\t} else {\n\t\t\t\t\treject(userInstance);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic setUserProp(id, prop): Promise<any> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.User.findById(id).then(userInstance => {\n\t\t\t\tconsole.log('found user', userInstance);\n\t\t\t\tresolve(userInstance.update({\n\t\t\t\t\t[prop.key]:prop.value\n\t\t\t\t}))\n\t\t\t}, error => {\n\t\t\t\t//todo will it break??\n\t\t\t\treject(new Error('update error with' + error));\n\t\t\t});\n\t\t})\n\t}\n\n\t// public registerUser(user: UserAttributes): Promise<UserAttributes> {\n\t// \treturn new Promise((resolve, reject) => {\n\t// \t\t//todo send to Auth for response\n\t// \t\t\tif (authUser.passHash && authUser.role) {\n\t// \t\t\t\tthis.createUser(authUser).then(userInstance => {\n\t// \t\t\t\t\tif (userInstance.id) {\n\t// \t\t\t\t\t\tresolve(userInstance);\n\t// \t\t\t\t\t} else {\n\t// \t\t\t\t\t\treject('error with registration');\n\t// \t\t\t\t\t}\n\t// \t\t\t\t});\n\t// \t\t\t}\n\t// \t});\n\t// }\n\n\t// private createUser(user: UserAttributes): Promise<any> {\n\t// \treturn new Promise((resolve, reject) => {\n\t// \t\tthis.User.create({\n\t// \t\t\tfirstName: user.firstName,\n\t// \t\t\tlastName: user.lastName,\n\t// \t\t\tpassHash: user.passHash,\n\t// \t\t\temail: user.email,\n\t// \t\t\taddressOne: user.addressOne,\n\t// \t\t\taddressTwo: user.addressTwo,\n\t// \t\t\tphone: user.phone,\n\t// \t\t\trole: user.role,\n\t// \t\t\tbusinessName: user.businessName,\n\t// \t\t\tbusinessWeb: user.businessWeb,\n\t// \t\t\tbusinessPhone: user.businessPhone,\n\t// \t\t\tbusinessFax: user.businessFax,\n\t// \t\t}).then(userInstance => {\n\t// \t\t\tconsole.log('user', userInstance);\n\t// \t\t\treturn userInstance;\n\t// \t\t})\n\t// \t})\n\t// }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/orm/store-manager.ts","export function userModel(DataTypes, sequlize) {\n\treturn sequlize.define('user', {\n\t\tid: {\n\t\t\ttype: DataTypes.UUID,\n\t\t\tprimaryKey: true,\n\t\t\tdefaultValue: DataTypes.UUIDV4\n\t\t},\n\t\tfirstName: {\n\t\t\ttype: DataTypes.STRING,\n\t\t},\n\t\tlastName: {\n\t\t\ttype: DataTypes.STRING,\n\t\t},\n\t\tpassHash: {\n\t\t\ttype: DataTypes.STRING,\n\t\t},\n\t\trole: {\n\t\t\ttype: DataTypes.ENUM,\n\t\t\tvalues: ['general', 'blocked', 'admin', 'removed'],\n\t\t\trequired: true\n\t\t},\n\t\temail: {\n\t\t\ttype: DataTypes.STRING,\n\t\t\trequired: true\n\t\t},\n\t\taddressOne: {\n\t\t\ttype: DataTypes.STRING\n\t\t},\n\t\taddressTwo: {\n\t\t\ttype: DataTypes.STRING\n\t\t},\n\t\tphone: {\n\t\t\ttype: DataTypes.STRING\n\t\t},\n\t\tbusinessName: {\n\t\t\ttype: DataTypes.STRING\n\t\t},\n\t\tbusinessWeb: {\n\t\t\ttype: DataTypes.STRING\n\t\t},\n\t\tbusinessPhone: {\n\t\t\ttype: DataTypes.STRING\n\t\t},\n\t\tbusinessFax: {\n\t\t\ttype: DataTypes.STRING\n\t\t},\n\t\tcreated_at: {\n\t\t\ttype: DataTypes.DATE,\n\t\t\tallowNull: false\n\t\t},\n\t\tupdated_at: DataTypes.DATE,\n\t\tdeleted_at: DataTypes.DATE\n\t}, {\n\t\tfreezeTableName: true,\n\t\tparanoid: false,\n\t\tunderscored: true,\n\t})\n}\n\n\n// WEBPACK FOOTER //\n// ./src/orm/table-models/user.table-model.ts","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"sequelize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sequelize\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 8\n// module chunks = 0"],"sourceRoot":""}